import{a as v}from"./chunk-R2O6QX4D-CX21ziz_.js";import{S as k}from"./chunk-PYIO3TDQ-D8Zv8hXV.js";import{u as C}from"./chunk-HFB3OQXI-BQr-MiKD.js";import{C as L}from"./chunk-2PMSBTXI-D-bGks_a.js";import{S as E}from"./chunk-D7H6ZNK4-C8uJw1mq.js";import{K as O}from"./chunk-6HTZNHPT-DfZIDBnp.js";import{b as m,u as T}from"./chunk-4TC5YS65-nGK-y6kq.js";import{a2 as F,a4 as j,dz as w,a5 as I,b as S,R as N,as as P,j as e,H as R,s as V,a8 as z,a9 as B,t as b,w as o,x as D,D as M,B as y}from"./index-CzNfOyID.js";import{u as $,c as q}from"./chunk-GRT22PE5-D62tp2cO.js";import{R as _}from"./radio-group-C4JY1QLP.js";import"./x-mark-mini-C21_Uzye.js";import"./triangles-mini-BMGfOEBt.js";import"./plus-mini-D3SBtq5M.js";import"./prompt-DreUfdsh.js";import"./index-B3dGGrSq.js";function H(c,n){const a={};return n.forEach(s=>{s in c&&(a[s]=c[s])}),a}var K=F({name:j().min(1),price_type:w(k),enabled_in_store:I().optional(),shipping_profile_id:j()}),A=({locationId:c,shippingOption:n,type:a})=>{const{t:s}=S(),{handleSuccess:h}=T(),u=a==="pickup",p=C({queryFn:i=>V.admin.shippingProfile.list(i),queryKey:["shipping_profiles"],getOptions:i=>i.shipping_profiles.map(d=>({label:d.name,value:d.id})),defaultValue:n.shipping_profile_id}),r=z({defaultValues:{name:n.name,price_type:n.price_type,enabled_in_store:v(n),shipping_profile_id:n.shipping_profile_id},resolver:B(K)}),{mutateAsync:t,isPending:f}=q(n.id),x=r.handleSubmit(async i=>{const d=n.rules.map(l=>({...H(l,["id","attribute","operator","value"])})),g=d.find(l=>l.attribute==="enabled_in_store");g?g.value=i.enabled_in_store?"true":"false":d.push({value:i.enabled_in_store?"true":"false",attribute:"enabled_in_store",operator:"eq"}),await t({name:i.name,price_type:i.price_type,shipping_profile_id:i.shipping_profile_id,rules:d},{onSuccess:({shipping_option:l})=>{b.success(s("stockLocations.shippingOptions.edit.successToast",{name:l.name})),h(`/settings/locations/${c}`)},onError:l=>{b.error(l.message)}})});return e.jsx(m.Form,{form:r,children:e.jsxs(O,{onSubmit:x,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(m.Body,{className:"overflow-y-auto",children:e.jsx("div",{className:"flex flex-col gap-y-8",children:e.jsxs("div",{className:"flex flex-col gap-y-8",children:[!u&&e.jsx(o.Field,{control:r.control,name:"price_type",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:s("stockLocations.shippingOptions.fields.priceType.label")}),e.jsx(o.Control,{children:e.jsxs(_,{...i,onValueChange:i.onChange,children:[e.jsx(_.ChoiceBox,{className:"flex-1",value:"flat",label:s("stockLocations.shippingOptions.fields.priceType.options.fixed.label"),description:s("stockLocations.shippingOptions.fields.priceType.options.fixed.hint")}),e.jsx(_.ChoiceBox,{className:"flex-1",value:"calculated",label:s("stockLocations.shippingOptions.fields.priceType.options.calculated.label"),description:s("stockLocations.shippingOptions.fields.priceType.options.calculated.hint")})]})}),e.jsx(o.ErrorMessage,{})]})}),e.jsxs("div",{className:"grid gap-y-4",children:[e.jsx(o.Field,{control:r.control,name:"name",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:s("fields.name")}),e.jsx(o.Control,{children:e.jsx(D,{...i})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx(o.Field,{control:r.control,name:"shipping_profile_id",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:s("stockLocations.shippingOptions.fields.profile")}),e.jsx(o.Control,{children:e.jsx(L,{...i,options:p.options,searchValue:p.searchValue,onSearchValueChange:p.onSearchValueChange,disabled:p.disabled})}),e.jsx(o.ErrorMessage,{})]})})]}),e.jsx(M,{}),e.jsx(E,{control:r.control,name:"enabled_in_store",label:s("stockLocations.shippingOptions.fields.enableInStore.label"),description:s("stockLocations.shippingOptions.fields.enableInStore.hint")})]})})}),e.jsx(m.Footer,{children:e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(y,{size:"small",variant:"secondary",children:s("actions.cancel")})}),e.jsx(y,{size:"small",type:"submit",isLoading:f,children:s("actions.save")})]})})]})})},re=()=>{const{t:c}=S(),{location_id:n,so_id:a}=N(),{shipping_options:s,isPending:h,isFetching:u,isError:p,error:r}=$({id:a,fields:"+service_zone.fulfillment_set.type"}),t=s==null?void 0:s.find(x=>x.id===a);if(!h&&!u&&!t)throw P({message:`Shipping option with ID ${a} was not found`},404);if(p)throw r;const f=(t==null?void 0:t.service_zone.fulfillment_set.type)==="pickup";return e.jsxs(m,{children:[e.jsx(m.Header,{children:e.jsx(R,{children:c(`stockLocations.${f?"pickupOptions":"shippingOptions"}.edit.header`)})}),t&&e.jsx(A,{shippingOption:t,locationId:n,type:t.service_zone.fulfillment_set.type})]})};export{re as Component};
