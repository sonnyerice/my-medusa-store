import{u as Z,a as De}from"./chunk-XMAWMECC-BsgLA1dz.js";import{a as Ce,j as i,b as J,bw as K,bx as X,C as V,H as Te,m as Ne,a0 as Fe,r as m,by as Ie,aj as Re,B as ee,k as te,al as $e,bj as Le,f as Ue,bz as D,bA as we,a1 as Ae,ae as re,bB as ke,ab as Pe,a9 as se}from"./index-qtvDi5Cm.js";import{a as Me}from"./chunk-OSOI7J6Y-CYu5osZ-.js";import{u as ve,_ as ze}from"./chunk-7VJK6HNE-Co1GQ4dC.js";import"./chunk-Z26G6WFJ-BUNYtSP_.js";import{S as Je}from"./chunk-2RQLKDBF-BqeX08dy.js";import{u as qe}from"./chunk-Q33G337Z-F4UTFYe3.js";import{u as Be,a as He,D as Ge,S as Ye}from"./chunk-ONULGYMV-bZ42rCPQ.js";import{u as We}from"./chunk-C76H5USB-5Tc5RsUF.js";import{R as Qe}from"./react-country-flag.esm-BtqKE_wm.js";import"./chunk-SJ3E4T6B-B2-FWnp0.js";import"./chunk-P3UUX2T6-CN0_cJGl.js";import"./chunk-PFKKVLZX-DLWbO_tZ.js";import"./chunk-CB22IFJF-DVzfJVWS.js";import"./chunk-7DXVXBSA-CCclXhoB.js";import"./chunk-ADOCJB6L-Bkdj6lUA.js";import"./chunk-Y2RYZS5B-DyMrZ3o1.js";import"./chunk-YEDAFXMB-DQ5sVYRA.js";import"./chunk-M3VFKDXJ-Dge3U42z.js";import"./chunk-AOFGTNG6-C05stc95.js";import"./chunk-EMIHDNB7-BCHGFe0n.js";import"./_isIndex-0vbaFt_d.js";import"./index-qLhlccdT.js";import"./Trans-gp5hX6TG.js";var B=$e(),ne=()=>{const{t:e}=J(),r=qe(),{regions:t}=Ne({limit:1e3,fields:"id,name"}),{sales_channels:n}=Fe({limit:1e3,fields:"id,name"});return m.useMemo(()=>{const s=[...r];return t!=null&&t.length&&s.push(B.accessor("region_id",{label:e("fields.region"),type:"multiselect",options:t.map(a=>({label:a.name,value:a.id}))})),n!=null&&n.length&&s.push(B.accessor("sales_channel_id",{label:e("fields.salesChannel"),type:"multiselect",options:n.map(a=>({label:a.name,value:a.id}))})),s},[t,n,r,e])},Ze=(e,r)=>r.split(".").reduce((t,n)=>t==null?void 0:t[n],e),$=(e,r="short")=>{const t=new Date(e);switch(r){case"short":return t.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});case"long":return t.toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"});case"relative":const s=new Date().getTime()-t.getTime(),a=Math.floor(s/(1e3*60*60*24));return a===0?"Today":a===1?"Yesterday":a<7?`${a} days ago`:t.toLocaleDateString("en-GB",{day:"numeric",month:"short"});default:return t.toLocaleDateString()}},Ke=({status:e})=>{const r=t=>{switch(t==null?void 0:t.toLowerCase()){case"paid":case"captured":return"green";case"pending":case"awaiting":return"orange";case"failed":case"canceled":return"red";default:return"grey"}};return i.jsx(se,{color:r(e),children:e})},Xe=({status:e})=>{const r=t=>{switch(t==null?void 0:t.toLowerCase()){case"fulfilled":case"shipped":return"green";case"partially_fulfilled":case"preparing":return"orange";case"canceled":case"returned":return"red";case"pending":case"not_fulfilled":return"grey";default:return"grey"}};return i.jsx(se,{color:r(e),children:e})},H=({status:e})=>i.jsx(re,{variant:"outline",className:"capitalize",children:e}),G={status:{payment:e=>i.jsx(Ke,{status:e}),fulfillment:e=>i.jsx(Xe,{status:e}),default:e=>i.jsx(H,{status:e})},currency:{default:(e,r)=>{if(e==null)return"-";const t=r.currency_code||"USD",n=Me(e,t);return i.jsx("div",{className:"flex h-full w-full items-center justify-end text-right",children:i.jsx("span",{className:"truncate",children:n})})}},timestamp:{creation:e=>e?$(e,"short"):"-",update:e=>e?$(e,"relative"):"-",default:e=>e?$(e,"short"):"-"},identifier:{order:e=>`#${e}`,default:e=>e},email:{default:e=>e||"-"},enum:{default:e=>i.jsx(H,{status:e})},string:{default:e=>e||"-"},number:{default:e=>(e==null?void 0:e.toLocaleString())||"0"},boolean:{default:e=>i.jsx(re,{variant:e?"solid":"outline",children:e?"Yes":"No"})},object:{relationship:e=>!e||typeof e!="object"?"-":e.name?e.name:e.title?e.title:e.email?e.email:e.display_name?e.display_name:JSON.stringify(e),default:e=>!e||typeof e!="object"?"-":e.name?e.name:e.title?e.title:e.email?e.email:JSON.stringify(e)},date:{default:e=>e?$(e,"short"):"-"},datetime:{default:e=>e?$(e,"long"):"-"},computed:{display:e=>e||"-",default:e=>e||"-"}},Ve=e=>{const r=G[e.semantic_type];if(r){const s=r[e.context];if(s)return s;const a=r.default;if(a)return a}const t=e.data_type==="text"?"string":e.data_type,n=G[t];if(n){const s=n.default;if(s)return s}return s=>String(s||"-")},et={customer_name:e=>{var r,t,n,s;if((r=e.customer)!=null&&r.first_name||(t=e.customer)!=null&&t.last_name){const a=`${e.customer.first_name||""} ${e.customer.last_name||""}`.trim();if(a)return a}return(n=e.customer)!=null&&n.email?e.customer.email:(s=e.customer)!=null&&s.phone?e.customer.phone:"Guest"},address_summary:(e,r)=>{let t=null;if((r==null?void 0:r.field)==="shipping_address_display"?t=e.shipping_address:(r==null?void 0:r.field)==="billing_address_display"?t=e.billing_address:t=e.shipping_address||e.billing_address,!t)return"-";const n=[];t.address_1&&n.push(t.address_1);const s=[];return t.city&&s.push(t.city),t.province&&s.push(t.province),t.postal_code&&s.push(t.postal_code),s.length>0&&n.push(s.join(", ")),t.country_code&&n.push(t.country_code.toUpperCase()),n.join(" â€¢ ")||"-"},country_code:e=>{var s;const r=(s=e.shipping_address)==null?void 0:s.country_code;if(!r)return i.jsx("div",{className:"flex w-full justify-center",children:"-"});const t=ke(r),n=(t==null?void 0:t.display_name)||r.toUpperCase();return i.jsx("div",{className:"flex w-full items-center justify-center",children:i.jsx(Pe,{content:n,children:i.jsx("div",{className:"flex size-4 items-center justify-center overflow-hidden rounded-sm",children:i.jsx(Qe,{countryCode:r.toUpperCase(),svg:!0,style:{width:"16px",height:"16px"},"aria-label":n})})})})}},tt={orders:{customer:{accessor:e=>{const r=e.shipping_address,t=e.customer;return r!=null&&r.first_name||r!=null&&r.last_name?`${r.first_name||""} ${r.last_name||""}`.trim():t!=null&&t.first_name||t!=null&&t.last_name?`${t.first_name||""} ${t.last_name||""}`.trim():(t==null?void 0:t.email)||"Guest"}}}},rt=(e,r,t)=>{if(t!=null&&t.computed){const s=et[t.computed.type];if(s)return a=>s(a,t)}const n=tt[e];{const s=n[r];if(s!=null&&s.accessor)return s.accessor}return s=>Ze(s,r)};function st(e){return e.semantic_type==="currency"||e.data_type==="currency"||e.data_type==="number"&&e.context!=="identifier"||e.field.includes("total")||e.field.includes("amount")||e.field.includes("price")?"right":e.field==="country"||e.field.includes("country_code")?"center":"left"}var nt=Ae();function it(e){return m.useMemo(()=>e!=null&&e.length?e.map(r=>{const t=Ve(r),n=rt("orders",r.field,r),s=st(r);return nt.accessor(n,{id:r.field,header:()=>r.name,cell:({getValue:a,row:c})=>{const j=a();return Le.isValidElement(j)?j:t(j,c.original)},meta:{name:r.name,column:r},enableHiding:r.hideable,enableSorting:!1,headerAlign:s})}):[],[e])}function at(e,r){const[t,n]=m.useState(()=>{if(e!=null&&e.length&&(r!=null&&r.configuration)){const o={};return e.forEach(f=>{var h;o[f.field]=((h=r.configuration.visible_columns)==null?void 0:h.includes(f.field))||!1}),o}else if(e!=null&&e.length)return w(e);return{}}),[s,a]=m.useState(()=>{var o;return(o=r==null?void 0:r.configuration)!=null&&o.column_order?r.configuration.column_order:e!=null&&e.length?A(e):[]}),c=m.useMemo(()=>({visibility:t,order:s}),[t,s]),j=m.useMemo(()=>({visible:Object.entries(t).filter(([f,h])=>h).map(([f])=>f),order:s}),[t,s]),b=m.useCallback(o=>{n(o)},[]),g=m.useCallback((o,f)=>{if(o!=null&&o.configuration){const h={};f.forEach(C=>{var T;h[C.field]=((T=o.configuration.visible_columns)==null?void 0:T.includes(C.field))||!1}),n(h),a(o.configuration.column_order||[])}else n(w(f)),a(A(f))},[]),u=m.useCallback(o=>{Object.keys(t).length===0&&n(w(o)),s.length===0&&a(A(o))},[]),y=m.useRef();return m.useEffect(()=>{var o,f,h;if(e!=null&&e.length){const C=((o=y.current)==null?void 0:o.id)!==(r==null?void 0:r.id),T=r&&((f=y.current)==null?void 0:f.id)===r.id&&y.current.updated_at!==r.updated_at;if(C||T)if(r!=null&&r.configuration){const F={};e.forEach(L=>{var U,I;F[L.field]=((I=(U=r.configuration)==null?void 0:U.visible_columns)==null?void 0:I.includes(L.field))||!1}),n(F),a(((h=r.configuration)==null?void 0:h.column_order)||[])}else n(w(e)),a(A(e))}y.current=r},[r,e]),{visibleColumns:t,columnOrder:s,columnState:c,currentColumns:j,setVisibleColumns:n,setColumnOrder:a,handleColumnVisibilityChange:b,handleViewChange:g,initializeColumns:u}}var Y=500;function w(e){if(!e||e.length===0)return{};const r={};return e.forEach(t=>{r[t.field]=t.default_visible??!0}),r}function A(e){return!e||e.length===0?[]:[...e].sort((t,n)=>{const s=t.default_order??Y,a=n.default_order??Y;return s-a}).map(t=>t.field)}var ot=({isDefaultView:e,currentViewId:r,currentViewName:t,onSaveAsDefault:n,onUpdateExisting:s,onSaveAsNew:a})=>{const c=Ue(),j=async()=>{await c({title:"Update default view",description:"This will update the default view for all users. Are you sure?",confirmText:"Update for everyone",cancelText:"Cancel"})&&n()},b=async()=>{await c({title:"Update view",description:`Are you sure you want to update "${t}"?`,confirmText:"Update",cancelText:"Cancel"})&&s()};return i.jsxs(D,{children:[i.jsx(D.Trigger,{asChild:!0,children:i.jsxs(ee,{variant:"secondary",size:"small",children:["Save",i.jsx(we,{})]})}),i.jsx(D.Content,{align:"end",children:e?i.jsxs(i.Fragment,{children:[i.jsx(D.Item,{onClick:j,children:"Update default for everyone"}),i.jsx(D.Item,{onClick:a,children:"Save as new view"})]}):i.jsxs(i.Fragment,{children:[i.jsxs(D.Item,{onClick:b,children:['Update "',t,'"']}),i.jsx(D.Item,{onClick:a,children:"Save as new view"})]})})]})},ie=["id","status","created_at","email","display_id","payment_status","fulfillment_status","total","currency_code"],ae=["*customer","*sales_channel"],k=`${ie.join(",")},${ae.join(",")}`;function lt(e,r){if(!(e!=null&&e.length))return k;const t=e.filter(u=>Object.keys(r).length>0?r[u.field]===!0:u.default_visible),n=new Set;t.forEach(u=>{var y,o;u.computed?((y=u.computed.required_fields)==null||y.forEach(f=>n.add(f)),(o=u.computed.optional_fields)==null||o.forEach(f=>n.add(f))):(u.field.includes("."),n.add(u.field))});const s=Array.from(n),a=s.filter(u=>u.includes(".")),c=s.filter(u=>!u.includes(".")),j=a.filter(u=>{const[y]=u.split(".");return!ae.some(f=>f===`*${y}`||f===y)}),b=c.filter(u=>!ie.includes(u)),g=[...j,...b];return g.length>0?`${k},${g.join(",")}`:k}function dt(e,r){return m.useMemo(()=>lt(e,r),[e,r])}var W=20,p="o";function Q(e){return e.startsWith("-")?{id:e.slice(1),desc:!0}:{id:e,desc:!1}}var ct=()=>{const{t:e}=J(),r=K("view_configurations"),{activeView:t,createView:n}=Be("orders"),s=(t==null?void 0:t.view_configuration)||null,{updateView:a}=He("orders",(s==null?void 0:s.id)||""),{columns:c,isLoading:j}=Ie("orders",{enabled:r}),b=ne(),g=We(["q","order",...b.map(d=>d.id)],p),[u,y]=Re(),{visibleColumns:o,columnOrder:f,currentColumns:h,setColumnOrder:C,handleColumnVisibilityChange:T,handleViewChange:F}=at(c,s);m.useEffect(()=>{c&&(F(s,c),y(d=>{if(Array.from(d.keys()).filter(l=>l.startsWith(p+"_")||l===p+"_q"||l===p+"_order").forEach(l=>d.delete(l)),s){const l=s.configuration;if(l.filters&&Object.entries(l.filters).forEach(([O,_])=>{d.set(`${p}_${O}`,JSON.stringify(_))}),l.sorting){const O=l.sorting.desc?`-${l.sorting.id}`:l.sorting.id;d.set(`${p}_order`,O)}l.search&&d.set(`${p}_q`,l.search)}return d}))},[s,c]);const[L,U]=m.useState(!1),I=m.useMemo(()=>{const d={};b.forEach(_=>{g[_.id]!==void 0&&(d[_.id]=JSON.parse(g[_.id]||""))});const E=g.order?Q(g.order):null,l=g.q||"",O=Object.entries(o).filter(([_,N])=>N).map(([_])=>_).sort();if(s){const _=s.configuration.filters||{},N=s.configuration.sorting,v=s.configuration.search||"",S=[...s.configuration.visible_columns||[]].sort(),R=s.configuration.column_order||[],xe=new Set([...Object.keys(d),...Object.keys(_)]);for(const q of xe)if(JSON.stringify(d[q])!==JSON.stringify(_[q]))return!0;const Oe=E||void 0,Ee=N||void 0;if(JSON.stringify(Oe)!==JSON.stringify(Ee)||l!==v||JSON.stringify(O)!==JSON.stringify(S)||JSON.stringify(f)!==JSON.stringify(R))return!0}else{if(Object.keys(d).length>0||E!==null||l!=="")return!0;if(c){const _=new Set(Object.entries(o).filter(([S,R])=>R).map(([S])=>S)),N=new Set(c.filter(S=>S.default_visible).map(S=>S.field));if(_.size!==N.size||[..._].some(S=>!N.has(S)))return!0;const v=c.sort((S,R)=>(S.default_order??500)-(R.default_order??500)).map(S=>S.field);if(JSON.stringify(f)!==JSON.stringify(v))return!0}}return!1},[s,o,f,b,g,c]);m.useEffect(()=>{const d=setTimeout(()=>{U(I)},50);return()=>clearTimeout(d)},[I]);const oe=m.useCallback(()=>{c&&F(s,c),y(d=>{if(Array.from(d.keys()).filter(l=>l.startsWith(p+"_")||l===p+"_q"||l===p+"_order").forEach(l=>d.delete(l)),s!=null&&s.configuration){const l=s.configuration;if(l.filters&&Object.entries(l.filters).forEach(([O,_])=>{d.set(`${p}_${O}`,JSON.stringify(_))}),l.sorting){const O=l.sorting.desc?`-${l.sorting.id}`:l.sorting.id;d.set(`${p}_order`,O)}l.search&&d.set(`${p}_q`,l.search)}return d})},[s,c]),x=m.useMemo(()=>{const d={};return b.forEach(E=>{g[E.id]!==void 0&&(d[E.id]=JSON.parse(g[E.id]||""))}),{filters:d,sorting:g.order?Q(g.order):null,search:g.q||""}},[b,g]),[le,P]=m.useState(!1),[de,M]=m.useState(null),ce=async()=>{try{s!=null&&s.is_system_default?await a.mutateAsync({name:s.name||null,configuration:{visible_columns:h.visible,column_order:h.order,filters:x.filters||{},sorting:x.sorting||null,search:x.search||""}}):await n.mutateAsync({name:"Default",is_system_default:!0,set_active:!0,configuration:{visible_columns:h.visible,column_order:h.order,filters:x.filters||{},sorting:x.sorting||null,search:x.search||""}})}catch{}},fe=async()=>{if(s)try{await a.mutateAsync({name:s.name,configuration:{visible_columns:h.visible,column_order:h.order,filters:x.filters||{},sorting:x.sorting||null,search:x.search||""}})}catch{}},ue=()=>{P(!0),M(null)},ge=dt(c,o),me=L?i.jsxs(i.Fragment,{children:[i.jsx(ee,{variant:"secondary",size:"small",type:"button",onClick:oe,children:e("actions.clear")}),i.jsx(ot,{isDefaultView:(s==null?void 0:s.is_system_default)||!s,currentViewId:s==null?void 0:s.id,currentViewName:s==null?void 0:s.name,onSaveAsDefault:ce,onUpdateExisting:fe,onSaveAsNew:ue})]}):null,{searchParams:he}=Z({pageSize:W,prefix:p}),{orders:ye,count:_e,isError:pe,error:be,isLoading:Se}=X({fields:ge,...he},{placeholderData:te}),je=it(c);if(pe)throw be;return i.jsxs(V,{className:"divide-y p-0",children:[i.jsx(Ge,{data:ye??[],columns:je,filters:b,getRowId:d=>d.id,rowCount:_e,enablePagination:!0,enableSearch:!0,pageSize:W,isLoading:Se||j,layout:"fill",heading:e("orders.domain"),enableColumnVisibility:r,initialColumnVisibility:o,onColumnVisibilityChange:T,columnOrder:f,onColumnOrderChange:C,enableViewSelector:r,entity:"orders",currentColumns:h,filterBarContent:me,rowHref:d=>`/orders/${d.id}`,emptyState:{empty:{heading:e("orders.list.noRecordsMessage")}},prefix:p}),le&&i.jsx(Ye,{entity:"orders",currentColumns:h,currentConfiguration:x,editingView:de,onClose:()=>{P(!1),M(null)},onSaved:()=>{P(!1),M(null)}})]})},z=20,ft=()=>{const{t:e}=J();if(K("view_configurations"))return i.jsx(ct,{});const{searchParams:t,raw:n}=Z({pageSize:z}),{orders:s,count:a,isError:c,error:j,isLoading:b}=X({fields:k,...t},{placeholderData:te}),g=ne(),u=De({}),{table:y}=ve({data:s??[],columns:u,enablePagination:!0,count:a,pageSize:z});if(c)throw j;return i.jsxs(V,{className:"divide-y p-0",children:[i.jsx("div",{className:"flex items-center justify-between px-6 py-4",children:i.jsx(Te,{children:e("orders.domain")})}),i.jsx(ze,{columns:u,table:y,pagination:!0,navigateTo:o=>`/orders/${o.original.id}`,filters:g,count:a,search:!0,isLoading:b,pageSize:z,orderBy:[{key:"display_id",label:e("orders.fields.displayId")},{key:"created_at",label:e("fields.createdAt")},{key:"updated_at",label:e("fields.updatedAt")}],queryObject:n,noRecords:{message:e("orders.list.noRecordsMessage")}})]})},At=()=>{const{getWidgets:e}=Ce();return i.jsx(Je,{widgets:{after:e("order.list.after"),before:e("order.list.before")},hasOutlet:!1,children:i.jsx(ft,{})})};export{At as Component};
