import{u as re}from"./chunk-HFB3OQXI-YBxq0DwM.js";import{C as K}from"./chunk-2PMSBTXI-G1PNC1Ke.js";import{o as te,p as z}from"./chunk-ZQRKUG6J-CYA1GE6k.js";import{D as R,c as ne,a as se}from"./chunk-Q4ST7H7M-BCfq9nGh.js";import{c as B}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{K as ie}from"./chunk-6HTZNHPT-CtfyeTpz.js";import{R as N,u as G,b as ae}from"./chunk-4TC5YS65-DIVSFOQE.js";import{am as D,ao as g,ap as V,ar as O,aA as le,ay as oe,a7 as ce,a6 as de,j as e,b as w,r as b,at as ue,au as me,aW as xe,m as W,F,S as A,t as pe,B as P,H as Q,Q as r,R as I,aw as E,s as he,V as $,I as ve,Y as fe,i as je,n as ye}from"./index-qtvDi5Cm.js";import{P as j}from"./progress-tabs-CQPt4xlW.js";import"./chunk-Y2RYZS5B-DyMrZ3o1.js";import"./_isIndex-0vbaFt_d.js";var L=D({title:g().min(1),sku:g().optional(),manage_inventory:V().optional(),allow_backorder:V().optional(),inventory_kit:V().optional(),options:O(g()),prices:O(g(),g().or(le()).optional()).optional(),inventory:oe(D({inventory_item_id:g(),required_quantity:te})).optional()}),X=L.pick({title:!0,sku:!0,manage_inventory:!0,allow_backorder:!0,inventory_kit:!0,options:!0}),ge=Object.keys(X.shape),Y=L.pick({prices:!0}),be=Object.keys(Y.shape);function _e({form:s,product:a}){const{t:o}=w(),l=F({control:s.control,name:"manage_inventory"});return e.jsx("div",{className:"flex flex-1 flex-col items-center overflow-y-auto",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 px-8 py-16",children:[e.jsx(Q,{level:"h1",children:o("products.variant.create.header")}),e.jsxs("div",{className:"my-8 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(r.Field,{control:s.control,name:"title",render:({field:t})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:o("fields.title")}),e.jsx(r.Control,{children:e.jsx(I,{...t})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:s.control,name:"sku",render:({field:t})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{optional:!0,children:o("fields.sku")}),e.jsx(r.Control,{children:e.jsx(I,{...t})}),e.jsx(r.ErrorMessage,{})]})}),a.options.map(t=>e.jsx(r.Field,{control:s.control,name:`options.${t.title}`,render:({field:{value:c,onChange:i,...n}})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:t.title}),e.jsx(r.Control,{children:e.jsx(K,{value:c,onChange:m=>{i(m)},...n,options:t.values.map(m=>({label:m.value,value:m.value}))})})]})},t.id))]}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(r.Field,{control:s.control,name:"manage_inventory",render:({field:{value:t,onChange:c,...i}})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"bg-ui-bg-component shadow-elevation-card-rest flex gap-x-3 rounded-lg p-4",children:[e.jsx(r.Control,{children:e.jsx(E,{className:"mt-[2px]",checked:t,onCheckedChange:n=>c(!!n),...i})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r.Label,{children:o("products.variant.inventory.manageInventoryLabel")}),e.jsx(r.Hint,{children:o("products.variant.inventory.manageInventoryHint")})]})]}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:s.control,name:"allow_backorder",disabled:!l,render:({field:{value:t,onChange:c,...i}})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"bg-ui-bg-component shadow-elevation-card-rest flex gap-x-3 rounded-lg p-4",children:[e.jsx(r.Control,{children:e.jsx(E,{checked:t,onCheckedChange:n=>c(!!n),...i,disabled:!l})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r.Label,{children:o("products.variant.inventory.allowBackordersLabel")}),e.jsx(r.Hint,{children:o("products.variant.inventory.allowBackordersHint")})]})]}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:s.control,name:"inventory_kit",render:({field:{value:t,onChange:c,...i}})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"bg-ui-bg-component shadow-elevation-card-rest flex gap-x-3 rounded-lg p-4",children:[e.jsx(r.Control,{children:e.jsx(E,{checked:t,onCheckedChange:n=>c(!!n),...i,disabled:!l})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r.Label,{children:o("products.variant.inventory.inventoryKit")}),e.jsx(r.Hint,{children:o("products.variant.inventory.inventoryKitHint")})]})]}),e.jsx(r.ErrorMessage,{})]})})]})]})})}var Ce=_e;function Ne({form:s}){const{t:a}=w(),o=A({control:s.control,name:"inventory"}),l=o.fields,t=re({queryKey:["inventory_items"],queryFn:i=>he.admin.inventoryItem.list(i),getOptions:i=>i.inventory_items.map(n=>({label:n.title,value:n.id}))}),c=(i,n)=>l==null?void 0:l.some((m,h)=>h!=n&&m.inventory_item_id===i.value);return e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsx("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:e.jsxs("div",{id:"organize",className:"flex flex-col gap-y-8",children:[e.jsx(Q,{children:a("products.create.inventory.heading")}),e.jsxs("div",{className:"grid gap-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r.Label,{children:s.getValues("title")}),e.jsx(r.Hint,{children:a("products.create.inventory.label")})]}),e.jsx(P,{size:"small",variant:"secondary",type:"button",onClick:()=>{o.append({inventory_item_id:"",required_quantity:""})},children:a("actions.add")})]}),o.fields.map((i,n)=>e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx($,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`inventory.${n}.inventory_item_id`,children:a("fields.item")})}),e.jsx(r.Field,{control:s.control,name:`inventory.${n}.inventory_item_id`,render:({field:m})=>e.jsx(r.Item,{children:e.jsx(r.Control,{children:e.jsx(K,{...m,options:t.options.map(h=>({...h,disabled:c(h,n)})),searchValue:t.searchValue,onSearchValueChange:t.onSearchValueChange,fetchNextPage:t.fetchNextPage,className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",placeholder:a("products.create.inventory.itemPlaceholder")})})})}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx($,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`inventory.${n}.required_quantity`,children:a("fields.quantity")})}),e.jsx(r.Field,{control:s.control,name:`inventory.${n}.required_quantity`,render:({field:{onChange:m,value:h,...y}})=>e.jsxs(r.Item,{children:[e.jsx(r.Control,{children:e.jsx(I,{type:"number",className:"bg-ui-bg-field-component",min:0,value:h,onChange:T=>{const k=T.target.value;m(k===""?null:Number(k))},...y,placeholder:a("products.create.inventory.quantityPlaceholder")})}),e.jsx(r.ErrorMessage,{})]})})]}),e.jsx(ve,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",onClick:()=>o.remove(n),children:e.jsx(fe,{})})]},i.id))]})]})})})}var we=Ne;function ke({form:s}){const{store:a}=je(),{regions:o}=W({limit:9999}),{price_preferences:l}=ye({}),{setCloseOnEscape:t}=G(),c=Pe({currencies:a==null?void 0:a.supported_currencies,regions:o,pricePreferences:l}),i=F({control:s.control});return e.jsx(R,{columns:c,data:[i],state:s,onEditingChange:n=>t(!n)})}var Fe=se(),Pe=({currencies:s=[],regions:a=[],pricePreferences:o=[]})=>{const{t:l}=w();return b.useMemo(()=>[Fe.column({id:l("fields.title"),header:l("fields.title"),cell:t=>{const c=t.row.original;return e.jsx(R.ReadonlyCell,{context:t,children:e.jsx("div",{className:"flex h-full w-full items-center gap-x-2 overflow-hidden",children:e.jsx("span",{className:"truncate",children:c.title})})})},disableHiding:!0}),...ne({currencies:s.map(t=>t.currency_code),regions:a,pricePreferences:o,getFieldName:(t,c)=>{var i;return(i=t.column.id)!=null&&i.startsWith("currency_prices")?`prices.${c}`:`prices.${c}`},t:l})],[l,s,a,o])},Te=ke,qe={detail:"in-progress",price:"not-started",inventory:"not-started"},Se=({product:s})=>{const{t:a}=w(),{handleSuccess:o}=G(),[l,t]=b.useState("detail"),[c,i]=b.useState(qe),n=ue({defaultValues:{sku:"",title:"",manage_inventory:!1,allow_backorder:!1,inventory_kit:!1,options:{}},resolver:me(L)}),{mutateAsync:m,isPending:h}=xe(s.id),{regions:y}=W({limit:9999}),T=b.useMemo(()=>y!=null&&y.length?y.reduce((d,f)=>(d[f.id]=f.currency_code,d),{}):{},[y]),k=F({control:n.control,name:"manage_inventory"}),q=F({control:n.control,name:"inventory_kit"}),M=A({control:n.control,name:"inventory"}),_=k&&q,v=b.useMemo(()=>_?["detail","price","inventory"]:["detail","price"],[_]);b.useEffect(()=>{q&&M.fields.length===0&&M.append({inventory_item_id:"",required_quantity:void 0})},[q]);const H=d=>{if(l===d)return;if(v.indexOf(d)<v.indexOf(l)){i(u=>({...u,[l]:"not-started",[d]:"in-progress"})),t(d);return}const f=v.slice(0,v.indexOf(d));for(const u of f)if(u==="detail"){if(!z(n,ge,X)){i(p=>({...p,[u]:"in-progress"})),t(u);return}i(p=>({...p,[u]:"completed"}))}else if(u==="price"){if(!z(n,be,Y)){i(p=>({...p,[u]:"in-progress"})),t(u);return}i(p=>({...p,[u]:"completed"}))}i(u=>({...u,[l]:"completed",[d]:"in-progress"})),t(d)},J=d=>{if(v.indexOf(d)+1>=v.length)return;const f=v[v.indexOf(d)+1];H(f)},U=n.handleSubmit(async d=>{const{allow_backorder:f,manage_inventory:u,sku:p,title:Z}=d;await m({title:Z,sku:p||void 0,allow_backorder:f,manage_inventory:u,options:d.options,prices:Object.entries(d.prices??{}).map(([x,S])=>{if(S===""||S===void 0)return;const C={},ee=B(S);return x.startsWith("reg_")?(C.rules={region_id:x},C.currency_code=T[x]):C.currency_code=x,C.amount=ee,C}).filter(Boolean),inventory_items:(d.inventory||[]).map(x=>!x.required_quantity||!x.inventory_item_id?!1:{...x,required_quantity:B(x.required_quantity)}).filter(Boolean)},{onSuccess:()=>{o()},onError:x=>{pe.error(x.message)}})});return e.jsx(N.Form,{form:n,children:e.jsx(j,{value:l,onValueChange:d=>H(d),className:"flex h-full flex-col overflow-hidden",children:e.jsxs(ie,{onSubmit:U,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(N.Header,{children:e.jsx("div",{className:"flex w-full items-center justify-between gap-x-4",children:e.jsx("div",{className:"-my-2 w-full max-w-[600px] border-l",children:e.jsxs(j.List,{className:"grid w-full grid-cols-3",children:[e.jsx(j.Trigger,{status:c.detail,value:"detail",children:a("priceLists.create.tabs.details")}),e.jsx(j.Trigger,{status:c.price,value:"price",children:a("priceLists.create.tabs.prices")}),!!_&&e.jsx(j.Trigger,{status:c.inventory,value:"inventory",children:a("products.create.tabs.inventory")})]})})})}),e.jsxs(N.Body,{className:"size-full overflow-hidden",children:[e.jsx(j.Content,{className:"size-full overflow-y-auto",value:"detail",children:e.jsx(Ce,{form:n,product:s})}),e.jsx(j.Content,{className:"size-full overflow-y-auto",value:"price",children:e.jsx(Te,{form:n})}),!!_&&e.jsx(j.Content,{className:"size-full overflow-hidden",value:"inventory",children:e.jsx(we,{form:n})})]}),e.jsx(N.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(ae.Close,{asChild:!0,children:e.jsx(P,{variant:"secondary",size:"small",children:a("actions.cancel")})}),e.jsx(Ve,{tab:l,next:J,isLoading:h,inventoryTabEnabled:!!_})]})})]})})})},Ve=({tab:s,next:a,isLoading:o,inventoryTabEnabled:l})=>{const{t}=w();return l&&s==="inventory"||!l&&s==="price"?e.jsx(P,{type:"submit",variant:"primary",size:"small",isLoading:o,children:t("actions.save")},"submit-button"):e.jsx(P,{type:"button",variant:"primary",size:"small",onClick:()=>a(s),children:t("actions.continue")},"next-button")},Re=()=>{const{id:s}=ce(),{product:a,isLoading:o,isError:l,error:t}=de(s);if(l)throw t;return e.jsx(N,{children:!o&&a&&e.jsx(Se,{product:a})})};export{Re as Component};
