import{u as Ee}from"./chunk-C76H5USB-5Tc5RsUF.js";import{b as re,bw as ce,bj as ee,r as d,aj as Fe,u as Ve,dm as Me,j as e,dn as S,H as de,U as ue,A as Pe,B as U,L as ke,dp as Oe,dq as Ie,dr as Le,ds as Re,dt as Ke,du as qe,at as $e,cr as v,V as ze,R as Be,f as Ue,ae as ie,bz as w,aG as Je,P as Qe,T as Xe,t as L,dv as Ye}from"./index-qtvDi5Cm.js";var J=(s,a)=>{let t=a;t||(s instanceof Ye||s.message?t=s.message:t="An error occurred"),L.error(t)},fe=s=>{const a=ce("view_configurations"),t=Oe(s,{limit:100},{enabled:a&&!!s}),n=Ie(s,{enabled:a&&!!s}),c=Le(s,{onSuccess:()=>{L.success("View created")},onError:p=>{J(p,"Failed to create view")}}),m=Re(s,{onSuccess:()=>{},onError:p=>{J(p,"Failed to update active view")}});return d.useMemo(()=>({isViewConfigEnabled:a,listViews:t,activeView:n,createView:c,setActiveView:m,isDefaultViewActive:(n==null?void 0:n.is_default_active)??!0}),[a,t,n,c,m])},he=(s,a)=>{const t=Ke(s,a,{onSuccess:()=>{L.success("View updated")},onError:c=>{J(c,"Failed to update view")}}),n=qe(s,a,{onSuccess:()=>{L.success("View deleted successfully")},onError:c=>{J(c,"Failed to delete view")}});return{updateView:t,deleteView:n}},Ge=({entity:s,currentColumns:a,currentConfiguration:t,editingView:n,onClose:c,onSaved:m})=>{const{createView:p}=fe(s),{updateView:D}=he(s,(n==null?void 0:n.id)||""),[T,g]=d.useState(!1),{register:V,handleSubmit:j,formState:{errors:b}}=$e({defaultValues:{name:(n==null?void 0:n.name)||""}}),u=async i=>{if(i.name.trim()){g(!0);try{if(n){const x=await D.mutateAsync({name:i.name.trim(),configuration:{visible_columns:(a==null?void 0:a.visible)||n.configuration.visible_columns,column_order:(a==null?void 0:a.order)||n.configuration.column_order,filters:(t==null?void 0:t.filters)||n.configuration.filters||{},sorting:(t==null?void 0:t.sorting)||n.configuration.sorting||null,search:(t==null?void 0:t.search)||n.configuration.search||""}});m(x.view_configuration)}else{const x=await p.mutateAsync({name:i.name.trim(),set_active:!0,configuration:{visible_columns:(a==null?void 0:a.visible)||[],column_order:(a==null?void 0:a.order)||[],filters:(t==null?void 0:t.filters)||{},sorting:(t==null?void 0:t.sorting)||null,search:(t==null?void 0:t.search)||""}});m(x.view_configuration)}}catch{}finally{g(!1)}}};return e.jsx(v,{open:!0,onOpenChange:c,children:e.jsxs(v.Content,{className:"flex flex-col",children:[e.jsxs(v.Header,{children:[e.jsx(v.Title,{asChild:!0,children:e.jsx(de,{children:n?"Edit View Name":"Save as New View"})}),e.jsx(v.Description,{asChild:!0,children:e.jsx(ue,{children:n?"Change the name of your saved view":"Save your current configuration as a new view"})})]}),e.jsxs("form",{onSubmit:j(u),className:"flex flex-1 flex-col",children:[e.jsx(v.Body,{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx(ze,{htmlFor:"name",weight:"plus",children:"View Name"}),e.jsx(Be,{...V("name",{required:"Name is required",validate:i=>i.trim().length>0||"Name cannot be empty"}),type:"text",placeholder:"Enter view name",autoFocus:!0}),b.name&&e.jsx("span",{className:"text-sm text-ui-fg-error",children:b.name.message})]})}),e.jsxs(v.Footer,{children:[e.jsx(v.Close,{asChild:!0,children:e.jsx(U,{variant:"secondary",size:"small",type:"button",children:"Cancel"})}),e.jsx(U,{variant:"primary",size:"small",type:"submit",isLoading:T,children:n?"Update":"Save"})]})]})]})})},We=({entity:s,currentColumns:a,currentConfiguration:t})=>{const{listViews:n,activeView:c,setActiveView:m,isDefaultViewActive:p}=fe(s),D=(n==null?void 0:n.view_configurations)||[],[T,g]=d.useState(!1),[V,j]=d.useState(null),[b,u]=d.useState(null),[i,x]=d.useState({x:0,y:0}),[M,_]=d.useState(null),R=Ue(),P=(c==null?void 0:c.view_configuration)||null,{deleteView:k}=he(s,M||""),y=async l=>{try{if(l===null){await m.mutateAsync(null);return}D.find($=>$.id===l)&&await m.mutateAsync(l)}catch(f){console.error("Error in handleViewSelect:",f)}},E=async l=>{await R({title:"Delete view",description:`Are you sure you want to delete "${l.name}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel"})&&_(l.id)};d.useEffect(()=>{M&&k.mutateAsync&&k.mutateAsync().then(()=>{_(null)}).catch(()=>{_(null)})},[M,k.mutateAsync]);const K=l=>{j(l),g(!0)},q=async l=>{await R({title:"Reset system default",description:"This will delete the saved system default and revert to the original code-level defaults. All users will be affected. Are you sure?",confirmText:"Reset",cancelText:"Cancel"})&&_(l.id)},O=D.find(l=>l.is_system_default),I=D.filter(l=>!l.is_system_default),Q=p;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx(ie,{color:Q?"blue":"grey",size:"xsmall",className:"cursor-pointer",onClick:()=>y(null),onContextMenu:l=>{l.preventDefault(),O&&(x({x:l.clientX,y:l.clientY}),u("default"))},children:"Default"}),O&&b==="default"&&e.jsxs(w,{open:!0,onOpenChange:l=>{l||u(null)},children:[e.jsx(w.Trigger,{asChild:!0,children:e.jsx("div",{style:{position:"fixed",left:i.x,top:i.y,width:0,height:0}})}),e.jsx(w.Content,{align:"start",sideOffset:0,children:e.jsxs(w.Item,{onClick:()=>{q(O),u(null)},className:"flex items-center gap-x-2",children:[e.jsx(Je,{className:"text-ui-fg-subtle"}),e.jsx("span",{children:"Reset to code defaults"})]})})]})]}),I.length>0&&e.jsx("div",{className:"text-ui-fg-muted",children:"|"}),I.map(l=>e.jsxs("div",{className:"relative inline-block",children:[e.jsx(ie,{color:(P==null?void 0:P.id)===l.id?"blue":"grey",size:"xsmall",className:"cursor-pointer",onClick:()=>y(l.id),onContextMenu:f=>{f.preventDefault(),x({x:f.clientX,y:f.clientY}),u(l.id)},children:l.name}),b===l.id&&e.jsxs(w,{open:!0,onOpenChange:f=>{f||u(null)},children:[e.jsx(w.Trigger,{asChild:!0,children:e.jsx("div",{style:{position:"fixed",left:i.x,top:i.y,width:0,height:0}})}),e.jsxs(w.Content,{align:"start",sideOffset:0,children:[e.jsxs(w.Item,{onClick:()=>{K(l),u(null)},className:"flex items-center gap-x-2",children:[e.jsx(Qe,{className:"text-ui-fg-subtle"}),e.jsx("span",{children:"Edit name"})]}),e.jsxs(w.Item,{onClick:()=>{E(l),u(null)},className:"flex items-center gap-x-2 text-ui-fg-error",children:[e.jsx(Xe,{}),e.jsx("span",{children:"Delete"})]})]})]})]},l.id))]}),T&&e.jsx(Ge,{entity:s,currentColumns:a,currentConfiguration:t,editingView:V,onClose:()=>{g(!1),j(null)},onSaved:async l=>{g(!1),j(null),L.success(`View "${l.name}" saved successfully`)}})]})},is=({data:s=[],columns:a,filters:t,commands:n,action:c,actionMenu:m,getRowId:p,rowCount:D=0,enablePagination:T=!0,enableSearch:g=!0,autoFocusSearch:V=!1,rowHref:j,heading:b,subHeading:u,prefix:i,pageSize:x=10,emptyState:M,rowSelection:_,isLoading:R=!1,layout:P="auto",enableColumnVisibility:k=!1,initialColumnVisibility:y={},onColumnVisibilityChange:E,columnOrder:K,onColumnOrderChange:q,enableViewSelector:O=!1,entity:I,currentColumns:Q,filterBarContent:se})=>{const{t:l}=re(),f=ce("view_configurations"),$=f&&k,me=f&&O,te=t&&t.length>0,xe=n&&n.length>0,X=a.some(o=>o.enableSorting),[Y,ae]=ee.useState(y);ee.useEffect(()=>{const o=Object.keys(Y).sort(),r=Object.keys(y).sort();(o.length!==r.length||o.some((A,F)=>A!==r[F])||Object.entries(y).some(([A,F])=>Y[A]!==F))&&ae(y)},[y]);const ge=ee.useCallback(o=>{ae(o),E==null||E(o)},[E]),z=d.useMemo(()=>(t==null?void 0:t.map(o=>o.id))??[],[t]),je=z.map(o=>N(o,i)),{offset:G,order:W,q:ne,...le}=Ee([...z,...X?["order"]:[],...g?["q"]:[],...T?["offset"]:[]],i),[ns,B]=Fe(),C=d.useMemo(()=>ne??"",[ne]),pe=o=>{B(r=>(o?r.set(N("q",i),o):r.delete(N("q",i)),r))},be=d.useMemo(()=>G?es(G,x):{pageIndex:0,pageSize:x},[G,x]),we=o=>{B(r=>(o.pageIndex===0?r.delete(N("offset",i)):r.set(N("offset",i),He(o).toString()),r))},Z=d.useMemo(()=>ss(z,le),[z,le]),ye=o=>{B(r=>(Array.from(r.keys()).forEach(h=>{je.includes(h)&&((i?h.replace(`${i}_`,""):h)in o||r.delete(h))}),Object.entries(o).forEach(([h,A])=>{const F=N(h,i);A!==void 0?r.set(F,JSON.stringify(A)):r.delete(F)}),r))},H=d.useMemo(()=>W?Ze(W):null,[W]),Se=d.useMemo(()=>({filters:Z,sorting:H,search:C}),[Z,H,C]),ve=o=>{B(r=>{if(o){const h=Ce(o);r.set(N("order",i),h)}else r.delete(N("order",i));return r})},{pagination:Ne,toolbar:De}=ts(),oe=Ve(),Te=d.useCallback((o,r)=>{if(!j)return;const h=j(r);if(o.metaKey||o.ctrlKey||o.button===1){window.open(h,"_blank","noreferrer");return}if(o.shiftKey){window.open(h,void 0,"noreferrer");return}oe(h)},[oe,j]),Ae=Me({data:s,columns:a,filters:t,commands:n,rowCount:D,getRowId:p,onRowClick:j?Te:void 0,pagination:T?{state:be,onPaginationChange:we}:void 0,filtering:te?{state:Z,onFilteringChange:ye}:void 0,sorting:X?{state:H,onSortingChange:ve}:void 0,search:g?{state:C,onSearchChange:pe}:void 0,rowSelection:_,isLoading:R,columnVisibility:$?{state:Y,onColumnVisibilityChange:ge}:void 0,columnOrder:$&&K&&q?{state:K,onColumnOrderChange:q}:void 0}),_e=b||u;return e.jsxs(S,{instance:Ae,className:P==="fill"?"h-full [&_tr]:last-of-type:!border-b":void 0,children:[e.jsx(S.Toolbar,{className:"flex flex-col items-start justify-between gap-2 md:flex-row md:items-center",translations:De,filterBarContent:se,children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-x-4",children:[_e&&e.jsxs("div",{children:[b&&e.jsx(de,{children:b}),u&&e.jsx(ue,{size:"small",className:"text-ui-fg-subtle",children:u})]}),me&&I&&e.jsx(We,{entity:I,currentColumns:Q,currentConfiguration:Se})]}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[te&&e.jsx(S.FilterMenu,{}),X&&e.jsx(S.SortingMenu,{}),g&&e.jsx("div",{className:"w-full md:w-auto",children:e.jsx(S.Search,{placeholder:l("filters.searchLabel"),autoFocus:V})}),m&&e.jsx(Pe,{variant:"primary",...m}),c&&e.jsx(as,{...c})]})]})}),e.jsx(S.Table,{emptyState:M}),T&&e.jsx(S.Pagination,{translations:Ne}),xe&&e.jsx(S.CommandBar,{selectedLabel:o=>`${o} selected`})]})};function Ce(s){return s.desc?`-${s.id}`:s.id}function Ze(s){return s.startsWith("-")?{id:s.slice(1),desc:!0}:{id:s,desc:!1}}function He(s){return s.pageIndex*s.pageSize}function es(s,a){const t=parseInt(s);return{pageIndex:Math.floor(t/a),pageSize:a}}function ss(s,a){if(!a)return{};const t={};for(const n of s){const c=a[n];c!==void 0&&(t[n]=JSON.parse(c))}return t}function N(s,a){return a?`${a}_${s}`:s}var ts=()=>{const{t:s}=re(),a={of:s("general.of"),results:s("general.results"),pages:s("general.pages"),prev:s("general.prev"),next:s("general.next")},t={clearAll:s("actions.clearAll"),sort:s("filters.sortLabel"),columns:"Columns"};return{pagination:a,toolbar:t}},as=({label:s,disabled:a,...t})=>{const n={size:"small",disabled:a??!1,type:"button",variant:"secondary"};return"to"in t?e.jsx(U,{...n,asChild:!0,children:e.jsx(ke,{to:t.to,children:s})}):e.jsx(U,{...n,onClick:t.onClick,children:s})};export{is as D,Ge as S,he as a,fe as u};
